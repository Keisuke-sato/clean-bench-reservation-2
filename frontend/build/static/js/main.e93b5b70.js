/*! For license information please see main.e93b5b70.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,n)=>{var r=n(853),a=n(43),l=n(950);function o(e){var t="https://30fe6a94-66a0-45a1-afa4-035ab9899a02.preview.emergentagent.com".replace(/\/+$/,""),jt="".concat(At||"","/api"),Dt=(zt.create({baseURL:jt}),()=>{const[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)((new Date).toISOString().split("T")[0]),[l,o]=(0,a.useState)(!1),[i,u]=(0,a.useState)(null),[s,f]=(0,a.useState)(!1),[d,p]=(0,a.useState)(""),[h,m]=(0,a.useState)({bench_id:"front",user_name:"",start_time:"",end_time:""}),g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;try{console.log("\u4e88\u7d04\u8aad\u307f\u8fbc\u307f\u958b\u59cb (\u8a66\u884c ".concat(e+1,"/").concat(r+1,"):"),n),f(!0),p("");const a={params:{date:n},timeout:8e3+2e3*e,validateStatus:function(e){return e>=200&&e<300},headers:{Accept:"application/json","Content-Type":"application/json"}},l=await zt.get("".concat(jt,"/reservations"),a);if(!Array.isArray(l.data))throw new Error("\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u7121\u52b9\u306a\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u8fd4\u3055\u308c\u307e\u3057\u305f");const o=l.data.filter((e=>e&&e.id&&e.bench_id&&e.user_name&&e.start_time&&e.end_time));o.length!==l.data.length&&console.warn("\u7121\u52b9\u306a\u4e88\u7d04\u30c7\u30fc\u30bf\u3092\u9664\u5916: ".concat(l.data.length-o.length,"\u4ef6")),console.log("\u4e88\u7d04\u30c7\u30fc\u30bf\u53d6\u5f97\u6210\u529f:",o),t(o)}catch(l){console.error("\u4e88\u7d04\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc (\u8a66\u884c ".concat(e+1,"):"),l);const t="ECONNABORTED"===l.code||"NETWORK_ERROR"===l.code||"ERR_NETWORK"===l.code||l.response&&l.response.status>=500||l.response&&503===l.response.status||l.response&&504===l.response.status;if(e<r&&t){const t=Math.min(1e3*2**e,8e3);console.log("".concat(t/1e3,"\u79d2\u5f8c\u306b\u81ea\u52d5\u30ea\u30c8\u30e9\u30a4\u3057\u307e\u3059...")),p("\u63a5\u7d9a\u4e2d\u3067\u3059... (".concat(e+1,"\u56de\u76ee\u518d\u8a66\u884c\u4e2d)")),setTimeout((()=>{g(e+1,r)}),t)}else{let e="\u4e88\u7d04\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f";var a;if(l.response)e=(null===(a=l.response.data)||void 0===a?void 0:a.detail)||"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc (".concat(l.response.status,")");else"ECONNABORTED"===l.code||"ERR_NETWORK"===l.code?e="\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059":l.message&&(e=l.message);p(e),console.error("\u6700\u5927\u30ea\u30c8\u30e9\u30a4\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f:",l)}}finally{f(!1)}};(0,a.useEffect)((()=>{g()}),[n]);const y=e=>{const t=new Date(e.start_time).toTimeString().substring(0,5),n=new Date(e.end_time).toTimeString().substring(0,5);m({bench_id:e.bench_id,user_name:e.user_name,start_time:t,end_time:n}),u(e),o(!1)},b=e=>{const t=new Date(n);t.setDate(t.getDate()+e),r(t.toISOString().split("T")[0])},v=e=>{const t=new Date(e.start_time),n=new Date(e.end_time),r=60*t.getHours()+t.getMinutes(),a=40/30;return{top:(r-420)*a,height:(60*n.getHours()+n.getMinutes()-r)*a}},w=e=>{const t=["#667eea","#764ba2","#f093fb","#f5576c","#4facfe","#00f2fe","#43e97b","#38f9d7","#ffecd2","#fcb69f","#a8edea","#fed6e3"];return t[e%t.length]},k=(()=>{const e=[];for(let t=7;t<=22;t++)for(let n=0;n<60;n+=30){const r="".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"));e.push(r)}return e})();return(0,Lt.jsx)("div",{className:"app",children:(0,Lt.jsxs)("div",{className:"container",children:[(0,Lt.jsxs)("header",{className:"header",children:[(0,Lt.jsx)("h1",{children:"\u30af\u30ea\u30fc\u30f3\u30d9\u30f3\u30c1\u4e88\u7d04\u30b7\u30b9\u30c6\u30e0"}),(0,Lt.jsx)("p",{className:"version-info",children:"\u30d0\u30fc\u30b8\u30e7\u30f3 2.0 - \u6539\u5584\u7248"})]}),(0,Lt.jsxs)("div",{className:"date-navigation",children:[(0,Lt.jsx)("button",{onClick:()=>b(-1),className:"nav-button",children:"\u2190 \u524d\u65e5"}),(0,Lt.jsx)("div",{className:"current-date",children:(S=n,new Date(S).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"}))}),(0,Lt.jsx)("button",{onClick:()=>b(1),className:"nav-button",children:"\u7fcc\u65e5 \u2192"})]}),(0,Lt.jsxs)("div",{className:"action-buttons",children:[(0,Lt.jsx)("button",{onClick:()=>{o(!0),u(null),m({bench_id:"front",user_name:"",start_time:"",end_time:""})},className:"create-button",children:"\u65b0\u898f\u4e88\u7d04"}),(0,Lt.jsx)("button",{onClick:()=>{console.log("\u624b\u52d5\u66f4\u65b0\u30dc\u30bf\u30f3\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u307e\u3057\u305f"),g(0,3)},className:"refresh-button",disabled:s,title:"\u4e88\u7d04\u4e00\u89a7\u3092\u624b\u52d5\u3067\u66f4\u65b0",children:s?"\ud83d\udd04 \u66f4\u65b0\u4e2d...":"\ud83d\udd04 \u66f4\u65b0"}),(0,Lt.jsx)("button",{onClick:()=>{window.confirm("30\u65e5\u3088\u308a\u53e4\u3044\u4e88\u7d04\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002\n\u5b9f\u884c\u3057\u307e\u3059\u304b\uff1f")&&(async()=>{try{f(!0),p("");const e=await zt.post("".concat(jt,"/cleanup/old-data"),{},{timeout:15e3});console.log("\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u5b8c\u4e86:",e.data),e.data.deleted_count>0?alert("\u2705 ".concat(e.data.deleted_count,"\u4ef6\u306e\u53e4\u3044\u4e88\u7d04\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u307e\u3057\u305f")):alert("\u2139\ufe0f \u524a\u9664\u5bfe\u8c61\u306e\u30c7\u30fc\u30bf\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f"),await g()}catch(n){var e,t;console.error("\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u30a8\u30e9\u30fc:",n);const r=(null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"\u30c7\u30fc\u30bf\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u306b\u5931\u6557\u3057\u307e\u3057\u305f";p("\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u30a8\u30e9\u30fc: ".concat(r))}finally{f(!1)}})()},className:"cleanup-button",disabled:s,title:"30\u65e5\u3088\u308a\u53e4\u3044\u4e88\u7d04\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5bb9\u91cf\u3092\u7bc0\u7d04",children:s?"\ud83e\uddf9 \u524a\u9664\u4e2d...":"\ud83e\uddf9 \u53e4\u3044\u30c7\u30fc\u30bf\u524a\u9664"})]}),d&&(0,Lt.jsxs)("div",{className:"error-container",children:[(0,Lt.jsxs)("div",{className:"error-message",children:["\u26a0\ufe0f ",d]}),(0,Lt.jsx)("button",{onClick:()=>{p(""),g(0,3)},className:"retry-button",disabled:s,children:s?"\u518d\u8a66\u884c\u4e2d...":"\ud83d\udd04 \u518d\u8a66\u884c"})]}),(l||i)&&(0,Lt.jsxs)("div",{className:"form-container",children:[(0,Lt.jsx)("h3",{children:i?"\u4e88\u7d04\u7de8\u96c6":"\u65b0\u898f\u4e88\u7d04"}),(0,Lt.jsxs)("form",{onSubmit:i?async e=>{e.preventDefault();try{f(!0),p("");const e={user_name:h.user_name,start_time:"".concat(n,"T").concat(h.start_time,":00"),end_time:"".concat(n,"T").concat(h.end_time,":00")};await zt.put("".concat(jt,"/reservations/").concat(i.id),e),m({bench_id:"front",user_name:"",start_time:"",end_time:""}),u(null),await g()}catch(a){var t,r;p((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.detail)||"\u4e88\u7d04\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{f(!1)}}:async e=>{e.preventDefault();try{f(!0),p("");const e=c(c({},h),{},{start_time:"".concat(n,"T").concat(h.start_time,":00"),end_time:"".concat(n,"T").concat(h.end_time,":00")});await zt.post("".concat(jt,"/reservations"),e),m({bench_id:"front",user_name:"",start_time:"",end_time:""}),o(!1),await g()}catch(a){var t,r;p((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.detail)||"\u4e88\u7d04\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{f(!1)}},children:[(0,Lt.jsxs)("div",{className:"form-group",children:[(0,Lt.jsx)("label",{children:"\u30d9\u30f3\u30c1:"}),(0,Lt.jsxs)("select",{value:h.bench_id,onChange:e=>m(c(c({},h),{},{bench_id:e.target.value})),disabled:!!i,children:[(0,Lt.jsx)("option",{value:"front",children:"\u624b\u524d"}),(0,Lt.jsx)("option",{value:"back",children:"\u5965"})]})]}),(0,Lt.jsxs)("div",{className:"form-group",children:[(0,Lt.jsx)("label",{children:"\u5229\u7528\u8005\u540d:"}),(0,Lt.jsx)("input",{type:"text",value:h.user_name,onChange:e=>m(c(c({},h),{},{user_name:e.target.value})),required:!0,placeholder:"\u304a\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,Lt.jsxs)("div",{className:"form-group",children:[(0,Lt.jsx)("label",{children:"\u958b\u59cb\u6642\u523b:"}),(0,Lt.jsx)("input",{type:"time",value:h.start_time,onChange:e=>m(c(c({},h),{},{start_time:e.target.value})),min:"07:00",max:"22:00",step:"1800",required:!0}),(0,Lt.jsx)("small",{style:{color:"#666",fontSize:"0.8rem"},children:"\u5229\u7528\u53ef\u80fd\u6642\u9593: 7:00-22:00 (30\u5206\u523b\u307f)"})]}),(0,Lt.jsxs)("div",{className:"form-group",children:[(0,Lt.jsx)("label",{children:"\u7d42\u4e86\u6642\u523b:"}),(0,Lt.jsx)("input",{type:"time",value:h.end_time,onChange:e=>m(c(c({},h),{},{end_time:e.target.value})),min:"07:00",max:"22:00",step:"1800",required:!0}),(0,Lt.jsx)("small",{style:{color:"#666",fontSize:"0.8rem"},children:"\u5229\u7528\u53ef\u80fd\u6642\u9593: 7:00-22:00 (30\u5206\u523b\u307f)"})]}),(0,Lt.jsxs)("div",{className:"form-buttons",children:[(0,Lt.jsx)("button",{type:"submit",disabled:s,children:i?"\u66f4\u65b0":"\u4e88\u7d04\u4f5c\u6210"}),i&&(0,Lt.jsx)("button",{type:"button",className:"delete-form-button",disabled:s,onClick:()=>{console.log("\u524a\u9664\u30dc\u30bf\u30f3\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u307e\u3057\u305f"),console.log("\u7de8\u96c6\u4e2d\u306e\u4e88\u7d04:",i);(async()=>{try{if(!window.confirm("\u26a0\ufe0f \u4e88\u7d04\u3092\u524a\u9664\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\n"+"\ud83d\udcdd \u5229\u7528\u8005: ".concat(i.user_name,"\n")+"\u23f0 \u6642\u9593: ".concat(new Date(i.start_time).toTimeString().substring(0,5)," - ").concat(new Date(i.end_time).toTimeString().substring(0,5),"\n")+"\ud83c\udfe2 \u30d9\u30f3\u30c1: ".concat("front"===i.bench_id?"\u624b\u524d":"\u5965","\n\n")+"\u274c \u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002\n\n\u524a\u9664\u3059\u308b\u5834\u5408\u306f\u300cOK\u300d\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002"))return void console.log("\u30e6\u30fc\u30b6\u30fc\u304c\u524a\u9664\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u307e\u3057\u305f");console.log("\u524a\u9664\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059..."),console.log("\u524a\u9664\u5bfe\u8c61ID:",i.id),f(!0),p("");const e=await zt.delete("".concat(jt,"/reservations/").concat(i.id));console.log("\u2705 \u524a\u9664\u6210\u529f:",e.data),u(null),m({bench_id:"front",user_name:"",start_time:"",end_time:""}),await g(),console.log("\u2705 \u524a\u9664\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f")}catch(d){var e,t;console.error("\u274c \u524a\u9664\u30a8\u30e9\u30fc:",d),d.response&&(console.error("\u30ec\u30b9\u30dd\u30f3\u30b9\u30a8\u30e9\u30fc:",d.response.data),console.error("\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9:",d.response.status)),p("\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ".concat((null===(e=d.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||d.message))}finally{f(!1)}})()},children:s?"\u524a\u9664\u4e2d...":"\ud83d\uddd1\ufe0f \u4e88\u7d04\u524a\u9664"}),(0,Lt.jsx)("button",{type:"button",onClick:()=>{o(!1),u(null),p("")},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]}),(0,Lt.jsxs)("div",{className:"timetable-container",children:[s&&(0,Lt.jsx)("div",{className:"loading",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),(0,Lt.jsxs)("div",{className:"timetable",children:[(0,Lt.jsxs)("div",{className:"timetable-header",children:[(0,Lt.jsx)("div",{className:"time-column-header",children:"\u6642\u523b"}),(0,Lt.jsx)("div",{className:"bench-column-header",children:"\u624b\u524d"}),(0,Lt.jsx)("div",{className:"bench-column-header",children:"\u5965"})]}),(0,Lt.jsxs)("div",{className:"timetable-grid",children:[(0,Lt.jsx)("div",{className:"time-column",children:k.map(((e,t)=>(0,Lt.jsx)("div",{className:"time-slot",children:e},e)))}),(0,Lt.jsx)("div",{className:"bench-column","data-bench":"front",children:(0,Lt.jsx)("div",{className:"bench-timeline",children:e.filter((e=>"front"===e.bench_id)).map(((e,t)=>{const{top:n,height:r}=v(e);return(0,Lt.jsxs)("div",{className:"reservation-bar",style:{top:"".concat(n,"px"),height:"".concat(r,"px"),backgroundColor:w(t),left:"2px",right:"2px"},onClick:()=>y(e),title:"\u30af\u30ea\u30c3\u30af\u3057\u3066\u7de8\u96c6: ".concat(e.user_name," (").concat(new Date(e.start_time).toTimeString().substring(0,5)," - ").concat(new Date(e.end_time).toTimeString().substring(0,5),")"),children:[(0,Lt.jsxs)("div",{className:"reservation-content",children:[(0,Lt.jsx)("div",{className:"reservation-user",children:e.user_name}),(0,Lt.jsxs)("div",{className:"reservation-time",children:[new Date(e.start_time).toTimeString().substring(0,5)," - ",new Date(e.end_time).toTimeString().substring(0,5)]})]}),(0,Lt.jsx)("div",{className:"edit-indicator",children:"\u7de8\u96c6"})]},e.id)}))})}),(0,Lt.jsx)("div",{className:"bench-column","data-bench":"back",children:(0,Lt.jsx)("div",{className:"bench-timeline",children:e.filter((e=>"back"===e.bench_id)).map(((e,t)=>{const{top:n,height:r}=v(e);return(0,Lt.jsxs)("div",{className:"reservation-bar",style:{top:"".concat(n,"px"),height:"".concat(r,"px"),backgroundColor:w(t+6),left:"2px",right:"2px"},onClick:()=>y(e),title:"\u30af\u30ea\u30c3\u30af\u3057\u3066\u7de8\u96c6: ".concat(e.user_name," (").concat(new Date(e.start_time).toTimeString().substring(0,5)," - ").concat(new Date(e.end_time).toTimeString().substring(0,5),")"),children:[(0,Lt.jsxs)("div",{className:"reservation-content",children:[(0,Lt.jsx)("div",{className:"reservation-user",children:e.user_name}),(0,Lt.jsxs)("div",{className:"reservation-time",children:[new Date(e.start_time).toTimeString().substring(0,5)," - ",new Date(e.end_time).toTimeString().substring(0,5)]})]}),(0,Lt.jsx)("div",{className:"edit-indicator",children:"\u7de8\u96c6"})]},e.id)}))})})]})]})]})]})});var S});l.createRoot(document.getElementById("root")).render((0,Lt.jsx)(a.StrictMode,{children:(0,Lt.jsx)(Dt,{})}))})();
//# sourceMappingURL=main.e93b5b70.js.map